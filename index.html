<!DOCTYPE html>
<html>
    <head>
	<link rel="stylesheet" href="js/bootstrap/css/bootstrap.css">
	<link rel="stylesheet" href="js/bootstrap/css/bootstrap-responsive.css">
	<style type="text/css">
	    body {
		padding: 5px;
	    }
	    a {
		cursor: pointer;
	    }
	    .available {
		color: green;
	    }
	    .unavailable {
		color: red;
	    }
	</style>
    </head>
    <body>
	<div class="container-fluid">
	    <div class="row-fluid">
		<div class="span9">
		    <table id="schedule" class="table table-bordered">
			<thead>
			    <tr>
				<th>Times</th>
				<th>Monday</th>
				<th>Tuesday</th>
				<th>Wednesday</th>
				<th>Thursday</th>
				<th>Friday</th>
			    </tr>
			</thead>
			<tbody>
			    <tr id="800">
				<td>8:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="900">
				<td>9:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="1000">
				<td>10:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="1100">
				<td>11:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="1200">
				<td>12:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="1300">
				<td>1:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="1400">
				<td>2:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="1500">
				<td>3:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="1600">
				<td>4:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="1700">
				<td>5:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="1800">
				<td>6:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="1900">
				<td>7:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="2000">
				<td>8:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="2100">
				<td>9:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			    <tr id="2200">
				<td>10:00</td>
				<td id="Monday"></td>
				<td id="Tuesday"></td>
				<td id="Wednesday"></td>
				<td id="Thursday"></td>
				<td id="Friday"></td>
			    </tr>
			</tbody>
		    </table>
		</div>
		<div class="span3 well">
		    <a data-toggle="collapse" data-target="#createTimeslotAccordion">
			Create Timeslot
		    </a>
		    <div id="createTimeslotAccordion" class="collapse">
			<input type="text" id="timeslot-name" placeholder="Name" />
			<input type="text" id="timeslot-time" placeholder="Time (military, no colon)" />	
			<select id="timeslot-day">
			    <option val="Monday">Monday</option>
			    <option val="Tuesday">Tuesday</option>
			    <option val="Wednesday">Wednesday</option>
			    <option val="Thursday">Thursday</option>
			    <option val="Friday">Friday</option>
			</select>
			<button type="button" id="create-timeslot" class="btn btn-primary">Create Timeslot</button>
		    </div>
		    <a data-toggle="collapse" data-target="#createWorkerAccordion">
			Create Worker
		    </a>
		    <div id="createWorkerAccordion" class="collapse">
			<input type="text" id="worker-name" placeholder="Name" />
			<button type="button" id="create-worker" class="btn btn-primary">Create Worker</button>
		    </div>
		    <hr>
		    <div id="workerDiv">
		      <h5>Worker List</h5>
		    </div>
		    <div id="timeslot-info" class="collapse">
		      <hr>
		      <h4 id="timeslot-info-name"></h4>
		      <select id="timeslot-info-select"></select>
		      <button type="button" class="btn btn-primary" id="choose-worker">Choose Worker</button>
		    </div>
		</div>
	    </div>
	</div>

	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
	<script src="js/bootstrap/js/bootstrap.js"></script>
	<script src="js/Timeslot.js"></script>
	<script src="js/Worker.js"></script>
	<script type="text/javascript">
	    
	    //Overwrite Array remove
	    Array.prototype.remove = function(from, to) {
		var rest = this.slice((to || from) + 1 || this.length);
		this.length = from < 0 ? this.length + from : from;
		return this.push.apply(this, rest);
	    };
	    
	    //Timeslot List
	    var timeslotList = new Array();
	    //Worker List
	    var workerList = new Array();
	    
	    $(document).ready(function() {
		$("button#create-timeslot").click(function() {
		    var name = $("input#timeslot-name").val().replace(/ /g, "_");
		    var time = $("input#timeslot-time").val();
		    var day = $("select#timeslot-day option:selected").val();
		    createTimeslot(time, day, name);
		});

		$("button#create-worker").click(function() {
		    var name = $("input#worker-name").val();
		    var s = new Worker(name);
		    workerList.push(s);
		    var workerAlert = "<span>" + name + " </span>";
		    var clone = $(workerAlert).clone();
		    $(clone).draggable({
			revert: true,
			cursor: "move"
		    });
		    $("#workerDiv").append(clone);
		});

		$("button#choose-worker").click(function() {
		    //Add Worker as final
		    var timeslotName = $("#timeslot-info-name").text();
		    var workerName = $("#timeslot-info-select option:selected").val();
		    var timeslot;
		    var worker;
		    //Find them in their arrays
		    //TODO: make this a function
		    for (var i = 0; i < timeslotList.length; i++) {
			if (timeslotName == timeslotList[i].name) {
			    timeslot = timeslotList[i];
			}
		    }
		    for (var i = 0; i < workerList.length; i++) {
			if (workerName == workerList[i].name) {
			    worker = workerList[i];
			}
		    }
		    //Iterate through all spans and set available or unavailable
		    $.each($("div.workers").find('span'), function() {
			if (workerName == "--None--" && timeslot.getFinalWorker() != null  && timeslot.getFinalWorker().getName() == $(this).text().trim()) {
			    $(this).removeClass('unavailable');
			    $(this).addClass('available');
			}
			else if ($(this).text().trim() == workerName) {
			    $(this).removeClass('available');
			    $(this).addClass('unavailable');
			}
		    });
		    $.each($("div#" + timeslotName).find('span'), function() {
			if (workerName == "--None--") {
			    $(this).removeClass('unavailable');
			    $(this).addClass('available');
			}
			else if ($(this).text().trim() == workerName) {
			    $(this).removeClass('unavailable');
			    $(this).addClass('available');
			} else {
			    $(this).removeClass('available');
			    $(this).addClass('unavailable');
			}
		    });
		    if (workerName == "--None--" && timeslot.getFinalWorker() != null) {
			timeslot.unsetFinalWorker(timeslot.getFinalWorker());
		    } else {
			timeslot.setFinalWorker(worker);
		    }

		});

		$(document).on('click', 'button.close', function() {
		    //Delete timeslot
		    var name = $(this).parent().attr('id');
		    for (var i = 0; i < timeslotList.length; i++) {
			if (timeslotList[i].name == name) {
			    timeslotList.remove(i);
			}
		    }
		    $(this).parent().remove(); 
		});

	    });
	    
	    //TODO: create delete worker functionality

	    function createTimeslot(time, day, name) {
		var s = new Timeslot(time, day, name);
		timeslotList.push(s);
		var timeslotDiv = "<div id='" + name + "' class='alert'><button type='button' class='close'>&times;</button><a onclick='timeslotInfo(this)'>" + name + "</a><div class='workers'></div></div>";
		var clone = $(timeslotDiv).clone();
		$(clone).droppable({
		    hoverClass: "alert-success",
		    drop: function(event, ui) {
			$(this).find("div.workers").append("<span class='available'>" + $(ui.draggable).text() + "</span>");
			var index = timeslotList.indexOf(s);
			timeslotList[index].addPossibleWorker($(ui.draggable).text().trim());
		      }
		});
		$("table#schedule tbody tr#" + time).find("#" + day).append(clone);
	    }

	    function timeslotInfo(link) {
		//Show timeslot info
		var div = $(link).parent();
		//Empty the select
		$("#timeslot-info-select").empty();
		//Add 'None' option 
		$('#timeslot-info-select').append("<option>--None--</option>");
		$.each($(div).find('span'), function() {
		    $("#timeslot-info-select").append("<option>" + $(this).text().trim() + "</option>");
		});
		$("#timeslot-info-name").text($(div).find('a').text());
		//Show info div
		$("#timeslot-info").collapse('show');

	    }

	</script>
    </body>
</html>
